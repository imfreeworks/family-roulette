<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>å®¶æ—ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆ v6ï¼ˆiPhoneæœ€é©ãƒ»ç›¤é¢ã‚»ãƒƒãƒˆå¼ï¼‰</title>
<style>
  :root{
    --bg:#f6f6f7;
    --card:#fff;
    --line:#e8e8ea;
    --text:#111;
    --muted:#666;
    --primary:#111;
    --danger:#b91c1c;
    --r:16px;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family: system-ui, -apple-system, "Hiragino Sans", "Noto Sans JP", sans-serif;
    background:var(--bg);
    color:var(--text);
  }
  .wrap{
    max-width: 520px;
    margin: 0 auto;
    padding: 14px 12px 24px;
  }
  header{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
    margin-bottom:10px;
  }
  h1{
    font-size:18px;
    margin:0;
    letter-spacing:.2px;
  }
  .badge{
    font-size:12px;
    color:var(--muted);
    border:1px solid var(--line);
    background:var(--card);
    padding:6px 10px;
    border-radius:999px;
    white-space:nowrap;
  }

  .card{
    background:var(--card);
    border:1px solid var(--line);
    border-radius: var(--r);
    padding: 12px;
  }

  .wheelBox{
    display:flex;
    justify-content:center;
    align-items:center;
    padding: 10px 0 6px;
  }
  canvas{
    display:block;             /* ã“ã‚Œé‡è¦ï¼šä½™è¨ˆãªä½™ç™½ã‚„ã‚ºãƒ¬ãŒå‡ºã«ãã„ */
    border-radius: 999px;
    box-shadow: 0 10px 24px rgba(0,0,0,.10);
    background:#fff;
  }

  .result{
    margin-top:10px;
    text-align:center;
    font-weight:800;
    font-size:22px;
  }
  .hint{
    margin-top:6px;
    text-align:center;
    font-size:12px;
    color:var(--muted);
  }

  .controls{
    margin-top:10px;
    display:grid;
    gap:8px;
  }
  .row{
    display:flex;
    gap:8px;
  }
  input{
    flex:1;
    font-size:16px;
    padding:12px 12px;
    border-radius: 12px;
    border:1px solid var(--line);
    background:#fff;
    outline:none;
  }
  button{
    font-size:16px;
    padding:12px 12px;
    border-radius: 12px;
    border:1px solid var(--line);
    background:#fff;
    cursor:pointer;
    white-space:nowrap;
  }
  button.primary{
    background:var(--primary);
    color:#fff;
    border-color:var(--primary);
  }
  button.danger{
    background:var(--danger);
    color:#fff;
    border-color:var(--danger);
  }
  button:disabled{opacity:.5; cursor:not-allowed}

  .toggles{
    display:flex;
    flex-wrap:wrap;
    gap:8px;
    align-items:center;
    justify-content:center;
    margin-top:8px;
  }
  .toggle{
    display:flex;
    align-items:center;
    gap:8px;
    font-size:14px;
    padding:8px 10px;
    border:1px solid var(--line);
    background:var(--card);
    border-radius:999px;
  }
  .toggle input{transform:scale(1.1)}

  details{
    margin-top:12px;
  }
  details > summary{
    list-style:none;
    cursor:pointer;
    user-select:none;
    font-weight:700;
    padding: 10px 12px;
    background:var(--card);
    border:1px solid var(--line);
    border-radius: var(--r);
  }
  details[open] > summary{
    border-bottom-left-radius: 10px;
    border-bottom-right-radius: 10px;
  }
  .list{
    border:1px solid var(--line);
    border-top:none;
    background:var(--card);
    border-bottom-left-radius: var(--r);
    border-bottom-right-radius: var(--r);
    padding: 10px 10px 12px;
  }

  .items{
    display:grid;
    grid-template-columns: 1fr auto auto auto auto;
    gap: 8px 8px;
    align-items:center;
  }
  .pill{
    border:1px solid var(--line);
    background:#fff;
    padding: 8px 10px;
    border-radius: 999px;
    font-size:14px;
    overflow:hidden;
    text-overflow:ellipsis;
    white-space:nowrap;
  }
  .wbox{
    min-width:40px;
    text-align:center;
    font-weight:700;
  }
  .mini{
    padding:8px 10px;
    font-size:14px;
    border-radius:999px;
  }

  .history{
    margin-top:10px;
    font-size:12px;
    color:var(--muted);
    text-align:left;
  }
</style>
</head>

<body>
<div class="wrap">
  <header>
    <h1>ğŸ½ å®¶æ—ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆ</h1>
    <div class="badge">v6 iPhone</div>
  </header>

  <div class="card">
    <div class="wheelBox">
      <canvas id="wheel"></canvas>
    </div>

    <div id="result" class="result">â€”</div>
    <div class="hint" id="hint">ã€Œãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆã‚»ãƒƒãƒˆã€â†’ã€Œå›ã™ã€</div>

    <div class="controls">
      <div class="row">
        <input id="item" placeholder="è¿½åŠ ï¼ˆä¾‹ï¼šã‚«ãƒ¬ãƒ¼ï¼‰" inputmode="text" />
        <button id="addBtn">è¿½åŠ </button>
      </div>

      <div class="row">
        <button id="setBtn">ğŸ§© ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆã‚»ãƒƒãƒˆ</button>
        <button id="spinBtn" class="primary">ğŸ¯ å›ã™</button>
      </div>

      <div class="row">
        <button id="delLastBtn">æœ€å¾Œå‰Šé™¤</button>
        <button id="clearHistBtn">å±¥æ­´ã‚¯ãƒªã‚¢</button>
        <button id="resetBtn" class="danger">åˆæœŸåŒ–</button>
      </div>

      <div class="toggles">
        <label class="toggle"><input id="avoidChk" type="checkbox" checked>æœ€è¿‘å‡ºãŸã®ã‚’æ¸›è¡°</label>
        <label class="toggle"><input id="noRepeatChk" type="checkbox" checked>ç›´å‰ã¯çµ¶å¯¾å‡ºãªã„</label>
      </div>
    </div>

    <details>
      <summary>å€™è£œã‚’ç·¨é›†ï¼ˆé‡ã¿èª¿æ•´ï¼‰</summary>
      <div class="list">
        <div id="rows" class="items"></div>
        <div class="history">å±¥æ­´ï¼ˆæœ€æ–°5ï¼‰ï¼š<span id="hist">â€”</span></div>
      </div>
    </details>
  </div>
</div>

<script>
/* =========================
   åŸºæœ¬
========================= */
const STORAGE_KEY = "family_roulette_v6";
const TAU = Math.PI * 2;
const POINTER_WORLD = -Math.PI / 2; // çŸ¢å°ã¯ä¸Šï¼ˆ12æ™‚ï¼‰

function norm(a){ a = a % TAU; return a < 0 ? a + TAU : a; }
function clamp(n, lo, hi){ return Math.max(lo, Math.min(hi, n)); }
function easeOutCubic(x){ return 1 - Math.pow(1-x, 3); }

/* =========================
   åˆæœŸå€¤ãƒ»ä¿å­˜
========================= */
function defaultState(){
  return {
    items: ["ã¾ã‚‹ãŒã‚ã›ã„ã‚ã‚“","ã‚¬ã‚¹ãƒˆ","ãƒãƒƒã‚¯","ãƒ”ã‚¶","ã•ã°ã”ã¯ã‚“","ãƒã‚«ãƒ­ãƒ‹ã‚µãƒ©ãƒ€","ãŠã†ã¡ãƒãƒ³ãƒãƒ¼ã‚°"],
    weights: [3,2,4,1,2,2,2],
    history: [],
    avoidRecent: true,
    noRepeat: true
  };
}

function sanitizeState(s){
  const d = defaultState();
  const items = Array.isArray(s.items) ? s.items.map(String) : d.items.slice();
  const weights = Array.isArray(s.weights) ? s.weights.map(x=>{
    const n = Number(x);
    return (isFinite(n) && n > 0) ? n : 1;
  }) : d.weights.slice();

  const L = Math.min(items.length, weights.length);
  const okLen = (L >= 2) ? L : d.items.length;

  return {
    items: items.slice(0, okLen),
    weights: weights.slice(0, okLen),
    history: Array.isArray(s.history) ? s.history.map(String).slice(0, 30) : [],
    avoidRecent: typeof s.avoidRecent === "boolean" ? s.avoidRecent : d.avoidRecent,
    noRepeat: typeof s.noRepeat === "boolean" ? s.noRepeat : d.noRepeat
  };
}

function loadState(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw) return defaultState();
    return sanitizeState(JSON.parse(raw));
  }catch{
    return defaultState();
  }
}

function saveState(){
  localStorage.setItem(STORAGE_KEY, JSON.stringify({
    items, weights, history,
    avoidRecent: avoidChk.checked,
    noRepeat: noRepeatChk.checked
  }));
}

/* =========================
   DOM
========================= */
const canvas = document.getElementById("wheel");
const ctx = canvas.getContext("2d");

const itemInput = document.getElementById("item");
const addBtn = document.getElementById("addBtn");
const setBtn = document.getElementById("setBtn");
const spinBtn = document.getElementById("spinBtn");
const delLastBtn = document.getElementById("delLastBtn");
const clearHistBtn = document.getElementById("clearHistBtn");
const resetBtn = document.getElementById("resetBtn");

const avoidChk = document.getElementById("avoidChk");
const noRepeatChk = document.getElementById("noRepeatChk");

const rowsEl = document.getElementById("rows");
const histEl = document.getElementById("hist");
const resultEl = document.getElementById("result");
const hintEl = document.getElementById("hint");

/* =========================
   çŠ¶æ…‹
========================= */
let { items, weights, history, avoidRecent, noRepeat } = loadState();
avoidChk.checked = avoidRecent;
noRepeatChk.checked = noRepeat;

let angle = 0;
let spinning = false;

// ã‚¹ãƒ”ãƒ³ä¸­å›ºå®š
let spinSegments = null;
// ç›¤é¢å›ºå®šï¼ˆã‚»ãƒƒãƒˆã§ç¢ºå®šï¼‰
let lockedSegments = null;

/* =========================
   Canvasãƒªã‚µã‚¤ã‚ºï¼ˆiPhoneã‚ºãƒ¬/ã«ã˜ã¿å¯¾ç­–ï¼‰
========================= */
let cssSize = 320; // è¡¨ç¤ºã‚µã‚¤ã‚ºï¼ˆCSS pxï¼‰
let dpr = 1;       // devicePixelRatio

function resizeCanvas(){
  // ç”»é¢å¹…ã«åˆã‚ã›ã¦ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆã‚µã‚¤ã‚ºã‚’æ±ºã‚ã‚‹ï¼ˆä½™ç™½è¾¼ã¿ï¼‰
  const vw = Math.min(window.innerWidth, 520);
  cssSize = clamp(Math.floor(vw - 48), 260, 380); // iPhoneå‘ã‘ã«å®‰å®š
  dpr = window.devicePixelRatio || 1;

  canvas.style.width = cssSize + "px";
  canvas.style.height = cssSize + "px";

  canvas.width  = Math.floor(cssSize * dpr);
  canvas.height = Math.floor(cssSize * dpr);

  // ä»¥å¾Œã®æç”»ã¯ CSS px å˜ä½ã§
  ctx.setTransform(dpr, 0, 0, dpr, 0, 0);

  draw();
}

/* =========================
   é‡ã¿ â†’ æœ‰åŠ¹é‡ã¿
========================= */
const HISTORY_LEN = 5;
const RECENT_DECAY = 0.6;

function computeEffectiveWeights(){
  const n = items.length;
  let eff = weights.map(w => {
    const base = Number(w);
    return (isFinite(base) && base > 0) ? base : 1;
  });

  if (avoidChk.checked){
    const recent = history.slice(0, HISTORY_LEN);
    const count = new Map();
    for(const x of recent) count.set(x, (count.get(x)||0) + 1);
    for(let i=0;i<n;i++){
      const c = count.get(items[i]) || 0;
      eff[i] = eff[i] * Math.pow(RECENT_DECAY, c);
    }
  }

  if (noRepeatChk.checked && history.length > 0 && n >= 2){
    const last = history[0];
    for(let i=0;i<n;i++){
      if(items[i] === last) eff[i] = 0;
    }
  }

  const sum = eff.reduce((a,b)=>a+b,0);
  if (sum <= 0){
    eff = weights.map(w => {
      const base = Number(w);
      return (isFinite(base) && base > 0) ? base : 1;
    });
  }
  return eff;
}

/* =========================
   ã‚»ã‚°ãƒ¡ãƒ³ãƒˆç”Ÿæˆ
========================= */
function buildSegments(eff){
  const safe = eff.map(w => (isFinite(w) && w > 0) ? w : 0);
  const sum = safe.reduce((a,b)=>a+b,0);

  let cur = 0;
  const segs = [];
  for(let i=0;i<items.length;i++){
    const span = (safe[i] / sum) * TAU;
    const s = cur;
    const e = cur + span;
    segs.push({ name: items[i], s, e });
    cur = e;
  }
  return segs;
}

/* =========================
   æç”»ï¼ˆç›¤é¢å›ºå®šå„ªå…ˆï¼‰
========================= */
function draw(){
  const W = cssSize, H = cssSize;
  const cx = W/2, cy = H/2, r = W/2 - 2;

  ctx.clearRect(0,0,W,H);

  // â˜…ã‚»ãƒƒãƒˆæ¸ˆã¿ã®ç›¤é¢ã‚’å„ªå…ˆ
  const segs = spinSegments ?? lockedSegments ?? buildSegments(computeEffectiveWeights());
  const N = segs.length;

  ctx.font = "14px system-ui";
  ctx.textBaseline = "middle";

  for(let i=0;i<N;i++){
    const g = segs[i];
    const a0 = angle + g.s;
    const a1 = angle + g.e;

    ctx.beginPath();
    ctx.moveTo(cx,cy);
    ctx.arc(cx,cy,r,a0,a1);
    ctx.closePath();
    ctx.fillStyle = `hsl(${(i*360/N)|0}, 82%, 72%)`;
    ctx.fill();
    ctx.strokeStyle = "rgba(0,0,0,.10)";
    ctx.stroke();

    // ãƒ©ãƒ™ãƒ«
    const mid = (a0 + a1) / 2;
    ctx.save();
    ctx.translate(cx,cy);
    ctx.rotate(mid);
    ctx.textAlign = "right";
    ctx.fillStyle = "rgba(0,0,0,.78)";
    ctx.fillText(g.name, r-16, 0);
    ctx.restore();
  }

  // ä¸­å¿ƒ
  ctx.beginPath();
  ctx.arc(cx,cy,18,0,TAU);
  ctx.fillStyle = "rgba(255,255,255,.92)";
  ctx.fill();
  ctx.strokeStyle = "rgba(0,0,0,.10)";
  ctx.stroke();

  // çŸ¢å°ï¼ˆä¸Šä¸­å¤®å›ºå®šï¼‰
  ctx.fillStyle = "#e11";
  ctx.beginPath();
  ctx.moveTo(cx-14, 8);
  ctx.lineTo(cx+14, 8);
  ctx.lineTo(cx, 30);
  ctx.closePath();
  ctx.fill();
  ctx.strokeStyle = "rgba(0,0,0,.12)";
  ctx.stroke();
}

/* =========================
   çŸ¢å°ãŒæŒ‡ã™å€™è£œ
========================= */
function pointedName(){
  const segs = spinSegments ?? lockedSegments ?? buildSegments(computeEffectiveWeights());
  let a = norm(POINTER_WORLD - angle);
  for(const s of segs){
    if (a >= s.s - 1e-12 && a < s.e + 1e-12) return s.name;
  }
  return segs[segs.length-1]?.name ?? "";
}

/* =========================
   æ­¢ã¾ã‚‹è§’åº¦ï¼šé‡ã¿ã«æ¯”ä¾‹ï¼ˆspinSegmentså‰æï¼‰
========================= */
function sampleStopAngleByWeight(){
  const segs = spinSegments;

  const safe = [];
  let total = 0;

  for(const s of segs){
    const span = s.e - s.s;
    const eps = Math.min(span * 0.08, 0.03);
    const low = s.s + eps;
    const high = s.e - eps;
    const w = Math.max(0, high - low);
    safe.push({ low, high, w });
    total += w;
  }

  if (total <= 0){
    const t = Math.random() * TAU;
    return norm(POINTER_WORLD - t);
  }

  let r = Math.random() * total;
  let chosen = safe[safe.length-1];
  for(const x of safe){
    r -= x.w;
    if (r <= 0){ chosen = x; break; }
  }

  const t = chosen.low + Math.random() * (chosen.high - chosen.low);
  return norm(POINTER_WORLD - t);
}

/* =========================
   å›è»¢ã‚¢ãƒ‹ãƒ¡
========================= */
function animateSpinTo(targetAngle){
  return new Promise(resolve=>{
    const start = angle;
    const extraTurns = 4 + Math.floor(Math.random()*4);
    const target = targetAngle + extraTurns * TAU;

    let delta = target - start;
    if (delta < 0) delta += Math.ceil((-delta)/TAU) * TAU;

    const duration = 1500 + extraTurns * 240;
    const t0 = performance.now();

    function step(t){
      const p = clamp((t - t0) / duration, 0, 1);
      const e = easeOutCubic(p);
      angle = norm(start + delta * e);
      draw();
      if (p < 1) requestAnimationFrame(step);
      else resolve();
    }
    requestAnimationFrame(step);
  });
}

/* =========================
   UIï¼šå€™è£œè¡¨ç¤ºï¼ˆiPhoneå‘ã‘ãƒ»ã‚·ãƒ³ãƒ—ãƒ«ï¼‰
========================= */
function renderRows(){
  rowsEl.innerHTML = "";
  for(let i=0;i<items.length;i++){
    const name = document.createElement("div");
    name.className = "pill";
    name.textContent = items[i];

    const w = document.createElement("div");
    w.className = "pill wbox";
    w.textContent = String(weights[i]);

    const minus = document.createElement("button");
    minus.className = "mini";
    minus.textContent = "âˆ’";
    minus.onclick = ()=>{
      weights[i] = Math.max(1, Number(weights[i]||1) - 1);
      saveState();
      // ç›¤é¢ã¯ã‚»ãƒƒãƒˆã¾ã§å›ºå®šï¼šè§¦ã£ãŸã‚‰â€œæœªã‚»ãƒƒãƒˆçŠ¶æ…‹â€ã«æˆ»ã™
      lockedSegments = null;
      hintEl.textContent = "å€™è£œ/é‡ã¿ã‚’å¤‰æ›´ã—ã¾ã—ãŸ â†’ ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆã‚»ãƒƒãƒˆã—ã¦ã­";
    };

    const plus = document.createElement("button");
    plus.className = "mini";
    plus.textContent = "ï¼‹";
    plus.onclick = ()=>{
      weights[i] = Math.min(99, Number(weights[i]||1) + 1);
      saveState();
      lockedSegments = null;
      hintEl.textContent = "å€™è£œ/é‡ã¿ã‚’å¤‰æ›´ã—ã¾ã—ãŸ â†’ ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆã‚»ãƒƒãƒˆã—ã¦ã­";
    };

    const del = document.createElement("button");
    del.className = "mini";
    del.textContent = "ğŸ—‘";
    del.onclick = ()=>{
      if(items.length <= 2) return;
      const removed = items[i];
      items.splice(i,1);
      weights.splice(i,1);
      history = history.filter(x=>x!==removed);

      lockedSegments = null;
      resultEl.textContent = "â€”";
      hintEl.textContent = "å€™è£œã‚’å‰Šé™¤ã—ã¾ã—ãŸ â†’ ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆã‚»ãƒƒãƒˆã—ã¦ã­";

      saveState();
      renderRows();
      draw();
    };

    rowsEl.appendChild(name);
    rowsEl.appendChild(w);
    rowsEl.appendChild(minus);
    rowsEl.appendChild(plus);
    rowsEl.appendChild(del);
  }

  histEl.textContent = history.length ? history.slice(0,5).join(" / ") : "â€”";
}

/* =========================
   æ“ä½œ
========================= */
function setRoulette(){
  if(items.length < 2){
    hintEl.textContent = "å€™è£œã¯2ã¤ä»¥ä¸Šå¿…è¦ã§ã™";
    return;
  }
  lockedSegments = buildSegments(computeEffectiveWeights());
  resultEl.textContent = "â€”";
  hintEl.textContent = "ã‚»ãƒƒãƒˆå®Œäº† â†’ å›ã›ã¾ã™";
  saveState();
  draw();
}

async function spin(){
  if(spinning) return;
  if(items.length < 2) return;
  if(!lockedSegments){
    hintEl.textContent = "å…ˆã«ã€Œãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆã‚»ãƒƒãƒˆã€ã‚’æŠ¼ã—ã¦ã­";
    return;
  }

  spinning = true;
  spinBtn.disabled = addBtn.disabled = delLastBtn.disabled = clearHistBtn.disabled = resetBtn.disabled = true;
  setBtn.disabled = true;

  // ã‚¹ãƒ”ãƒ³ä¸­å›ºå®šï¼šã‚»ãƒƒãƒˆæ¸ˆã¿ç›¤é¢ã‚’ãã®ã¾ã¾åˆ©ç”¨
  spinSegments = lockedSegments;

  const stopAngle = sampleStopAngleByWeight();
  await animateSpinTo(stopAngle);

  const winner = pointedName();
  history.unshift(winner);
  history = history.slice(0, 30);

  resultEl.textContent = `âœ… ${winner}`;
  hintEl.textContent = "ã‚‚ã†ä¸€å›å›ã™ãªã‚‰ãã®ã¾ã¾ã€Œå›ã™ã€OK";

  saveState();

  spinSegments = null;
  spinning = false;

  spinBtn.disabled = addBtn.disabled = delLastBtn.disabled = clearHistBtn.disabled = resetBtn.disabled = false;
  setBtn.disabled = false;

  renderRows();
  draw();
}

function addItem(){
  const v = itemInput.value.trim();
  if(!v) return;

  items.push(v);
  weights.push(1);
  itemInput.value = "";

  lockedSegments = null;
  resultEl.textContent = "â€”";
  hintEl.textContent = "å€™è£œã‚’è¿½åŠ ã—ã¾ã—ãŸ â†’ ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆã‚»ãƒƒãƒˆã—ã¦ã­";

  saveState();
  renderRows();
  draw();
}

function delLast(){
  if(items.length <= 2) return;
  const removed = items[items.length-1];
  items.pop();
  weights.pop();
  history = history.filter(x=>x!==removed);

  lockedSegments = null;
  resultEl.textContent = "â€”";
  hintEl.textContent = "å€™è£œã‚’å‰Šé™¤ã—ã¾ã—ãŸ â†’ ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆã‚»ãƒƒãƒˆã—ã¦ã­";

  saveState();
  renderRows();
  draw();
}

function clearHistory(){
  history = [];
  lockedSegments = null; // æ¸›è¡°æ¡ä»¶ãŒå¤‰ã‚ã‚‹ã®ã§ç›¤é¢ã‚‚è§£é™¤
  resultEl.textContent = "â€”";
  hintEl.textContent = "å±¥æ­´ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ â†’ ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆã‚»ãƒƒãƒˆã—ã¦ã­";

  saveState();
  renderRows();
  draw();
}

function resetAll(){
  const d = defaultState();
  items = d.items.slice();
  weights = d.weights.slice();
  history = [];
  avoidChk.checked = true;
  noRepeatChk.checked = true;

  angle = 0;
  lockedSegments = null;

  resultEl.textContent = "â€”";
  hintEl.textContent = "åˆæœŸåŒ–ã—ã¾ã—ãŸ â†’ ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆã‚»ãƒƒãƒˆã—ã¦ã­";

  saveState();
  renderRows();
  draw();
}

/* =========================
   ã‚¤ãƒ™ãƒ³ãƒˆ
========================= */
addBtn.addEventListener("click", addItem);
itemInput.addEventListener("keydown", (e)=>{ if(e.key==="Enter") addItem(); });

setBtn.addEventListener("click", setRoulette);
spinBtn.addEventListener("click", spin);

delLastBtn.addEventListener("click", delLast);
clearHistBtn.addEventListener("click", clearHistory);
resetBtn.addEventListener("click", resetAll);

avoidChk.addEventListener("change", ()=>{
  saveState();
  lockedSegments = null;
  hintEl.textContent = "è¨­å®šã‚’å¤‰æ›´ã—ã¾ã—ãŸ â†’ ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆã‚»ãƒƒãƒˆã—ã¦ã­";
});
noRepeatChk.addEventListener("change", ()=>{
  saveState();
  lockedSegments = null;
  hintEl.textContent = "è¨­å®šã‚’å¤‰æ›´ã—ã¾ã—ãŸ â†’ ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆã‚»ãƒƒãƒˆã—ã¦ã­";
});

// ç”»é¢å›è»¢ã‚„ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒãƒ¼ä¼¸ç¸®ã§ã‚‚å´©ã‚Œã«ãã
window.addEventListener("resize", resizeCanvas);

/* =========================
   åˆæœŸè¡¨ç¤º
========================= */
renderRows();
resizeCanvas();     // ã‚µã‚¤ã‚ºç¢ºå®šâ†’æç”»
setRoulette();      // åˆå›ã¯è‡ªå‹•ã§ã‚»ãƒƒãƒˆã—ã¦ã™ãå›ã›ã‚‹ã‚ˆã†ã«
</script>
</body>
</html>
